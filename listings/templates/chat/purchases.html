{% extends "base.html" %}

{% block title %}My Purchases{% endblock %}

{% block content %}
<div style="max-width: 1000px; margin: 50px auto; padding: 20px;">
    <h1>My Purchases</h1>
    
    <div style="background: white; padding: 30px; border-radius: 10px; margin-bottom: 30px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <h2>Buying ({{ buying.count }})</h2>
        {% if buying %}
            {% for purchase in buying %}
                <div style="border: 1px solid #ddd; padding: 20px; margin: 15px 0; border-radius: 8px; border-left: 4px solid 
                    {% if purchase.status == 'complete' %}#28a745
                    {% elif purchase.status == 'cancelled' %}#dc3545
                    {% else %}#ffc107{% endif %};">
                    
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div>
                            <h3 style="margin-top: 0;">{{ purchase.listing.title }}</h3>
                            <p><strong>Seller:</strong> {{ purchase.seller.username }}</p>
                            <p><strong>Price:</strong> ${{ purchase.agreed_price }}</p>
                            <p><strong>Location:</strong> {{ purchase.meetup_location }}</p>
                            <p><strong>Meetup:</strong> {{ purchase.meetup_time|date:"M d, Y \a\t g:i A" }}</p>
                            <p><strong>Status:</strong> 
                                {% if purchase.status == 'complete' %}
                                    <span style="color: #28a745;">Completed</span>
                                {% elif purchase.status == 'cancelled' %}
                                    <span style="color: #dc3545;">Cancelled</span>
                                {% else %}
                                    <span style="color: #ffc107;">Pending</span>
                                {% endif %}
                            </p>
                        </div>
                        <div>
                            <a href="{% url 'listings:data_listing' user_id=purchase.seller.id listing_id=purchase.listing.id %}" 
                            style="display: inline-block; padding: 8px 15px; background: #007bff; color: white; text-decoration: none; border-radius: 5px;">
                                View Chat
                            </a>
                        </div>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <p style="color: #666;">No buying purchases yet.</p>
        {% endif %}
    </div>
    
    <div style="background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <h2>Selling ({{ selling.count }})</h2>
        {% if selling %}
            {% for purchase in selling %}
                <div style="border: 1px solid #ddd; padding: 20px; margin: 15px 0; border-radius: 8px; border-left: 4px solid 
                    {% if purchase.status == 'complete' %}#28a745
                    {% elif purchase.status == 'cancelled' %}#dc3545
                    {% else %}#ffc107{% endif %};">
                    
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div>
                            <h3 style="margin-top: 0;">{{ purchase.listing.title }}</h3>
                            <p><strong>Buyer:</strong> {{ purchase.buyer.username }}</p>
                            <p><strong>Price:</strong> ${{ purchase.agreed_price }}</p>
                            <p><strong>Location:</strong> {{ purchase.meetup_location }}</p>
                            <p><strong>Meetup:</strong> {{ purchase.meetup_time|date:"M d, Y \a\t g:i A" }}</p>
                            <p><strong>Status:</strong> 
                                {% if purchase.status == 'complete' %}
                                    <span style="color: #28a745;">Completed</span>
                                {% elif purchase.status == 'cancelled' %}
                                    <span style="color: #dc3545;">Cancelled</span>
                                {% else %}
                                    <span style="color: #ffc107;">Pending</span>
                                {% endif %}
                            </p>
                        </div>
                        <div>
                            <a href="{% url 'listings:data_listing' user_id=purchase.buyer.id listing_id=purchase.listing.id %}" 
                            style="display: inline-block; padding: 8px 15px; background: #007bff; color: white; text-decoration: none; border-radius: 5px;">
                                View Chat
                            </a>
                        </div>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <p style="color: #666;">No selling purchases yet.</p>
        {% endif %}
    </div>
    
    <a href="{% url 'homepage' %}" 
    style="display: inline-block; margin-top: 20px; padding: 10px 20px; background: #6c757d; color: white; text-decoration: none; border-radius: 5px;">
        Back to Home
    </a>
</div>
{% endblock %}